<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>ë„ê·¼ì  20ê°œ í‘œì‹œ ì§€ë„</title>
    <style>
        #map {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9BIK9PhwIvEL5uzIlGtTh2iK8piDn2pw"></script>

    <div id="map"></div>

    <script>
        // ---------------------------
        // ğŸ”‘ VWorld ê°œë°œìš© API í‚¤
        // ---------------------------
        const VWORLD_KEY = "7E3F201-5A0A-3513-8DC6-6E831632BDC4";

        let map;
        let markers = [];

        function initMap() {

            const center = { lat: 36.4800, lng: 127.2890 }; // ì„¸ì¢… ê¸°ì¤€

            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
                center: center,
            });

            // ì²« ë„ê·¼ì  ë¡œë“œ
            loadGeogung(center);

            // ì§€ë„ ì´ë™ í›„ ì¤‘ì‹¬ ë³€ê²½ë˜ë©´ ë‹¤ì‹œ ë¡œë“œ
            google.maps.event.addListener(map, "idle", function () {
                const c = map.getCenter();
                loadGeogung({ lat: c.lat(), lng: c.lng() });
            });
        }

        // -----------------------------------------
        // ğŸ“Œ ë„ê·¼ì  20ê°œ ê°€ì ¸ì˜¤ê¸° (ìš´ì˜/ê°œë°œ ë¬´ê´€í•˜ê²Œ ì‘ë™)
        // -----------------------------------------
        function loadGeogung(center) {

            const xmin = center.lng - 0.01;
            const ymin = center.lat - 0.01;
            const xmax = center.lng + 0.01;
            const ymax = center.lat + 0.01;

            const url =
                `https://api.vworld.kr/req/wfs?` +
                `key=${VWORLD_KEY}` +
                `&service=WFS` +
                `&version=2.0.0` +
                `&request=GetFeature` +
                `&typeNames=lp_pa_cbnd@korea` +
                `&count=20` +
                `&srsName=EPSG:4326` +
                `&bbox=${xmin},${ymin},${xmax},${ymax},EPSG:4326`;

            fetch(url)
                .then(res => res.json())
                .then(data => {

                    if (!data.response?.result?.featureCollection?.features) return;

                    const features = data.response.result.featureCollection.features;

                    // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                    markers.forEach(m => m.setMap(null));
                    markers = [];

                    // ë§ˆì»¤ í‘œì‹œ
                    features.forEach(f => {
                        const [lng, lat] = f.geometry.coordinates;

                        const marker = new google.maps.Marker({
                            position: { lat, lng },
                            map: map,
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                fillColor: "red",
                                fillOpacity: 1,
                                strokeColor: "white",
                                strokeWeight: 1,
                                scale: 6
                            }
                        });

                        markers.push(marker);
                    });
                })
                .catch(err => console.error("VWorld API ì˜¤ë¥˜:", err));
        }

        window.onload = initMap;
    </script>

</body>
</html>
