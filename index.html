<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ë„ê·¼ì  20ê°œ í‘œì‹œ ì§€ë„</title>
  <style>
    #map {
      width: 100%;
      height: 100vh;
      margin: 0;
      padding: 0;
    }
  </style>

  <!-- Google Maps JS API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAP_KEY"></script>

  <script>
    // VWorld API Key
    const VWORLD_KEY = "7E3F2D01-5A0A-3513-8DC6-6E831632BDC4";

    let map;

    function initMap() {
      const center = { lat: 37.5665, lng: 126.9780 }; // ì´ˆê¸° ì„œìš¸ ì¤‘ì‹¬

      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: center,
      });

      // ìµœì´ˆ ë¡œë”©
      loadDegunjum(center);

      // ğŸ”¥ ì§€ë„ë¥¼ ì›€ì§ì´ê³  ë©ˆì¶”ë©´(center ë³€ê²½ë˜ë©´) ìë™ ì—…ë°ì´íŠ¸
      google.maps.event.addListener(map, "idle", function () {
        const c = map.getCenter();
        loadDegunjum({ lat: c.lat(), lng: c.lng() });
      });
    }

    async function loadDegunjum(center) {
      const delta = 0.01;

      const bbox = [
        center.lng - delta,
        center.lat - delta,
        center.lng + delta,
        center.lat + delta
      ].join(",");

      const url = `https://api.vworld.kr/req/data?service=data&version=2.0&request=GetFeature&format=json&type=LT_LM_DEGN&bbox=${bbox}&key=${VWORLD_KEY}`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data.response || !data.response.result) {
          console.log("ë„ê·¼ì  ì—†ìŒ");
          return;
        }

        const features = data.response.result.featureCollection.features;

        // ğŸ”¥ ê¸°ì¡´ ë§ˆì»¤ ì œê±° â†’ ì§€ë„ ê¹”ë”í•˜ê²Œ ìœ ì§€í•˜ë ¤ë©´ ì—¬ê¸°ì— marker ë°°ì—´ ê´€ë¦¬ ì¶”ê°€ ê°€ëŠ¥

        const points = features.slice(0, 20); // ìµœëŒ€ 20ê°œ

        points.forEach((f) => {
          const [lng, lat] = f.geometry.coordinates;

          new google.maps.Marker({
            position: { lat, lng },
            map: map,
            title: "ë„ê·¼ì ",
          });
        });
      } catch (e) {
        console.error("API ì˜¤ë¥˜:", e);
      }
    }

    window.onload = initMap;
  </script>
</head>

<body>
  <div id="map"></div>
</body>
</html>
