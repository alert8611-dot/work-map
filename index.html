<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>ë„ê·¼ì  20ê°œ í‘œì‹œ ì§€ë„</title>
    <style>
        #map {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>

    <!-- Google Maps API (ì—¬ê¸°ì— ë„ˆì˜ ì‹¤ì œ Google API í‚¤ ë„£ê¸°) -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAP_KEY"></script>

    <div id="map"></div>

    <script>
        // ---------------------------
        // ğŸ”‘ VWorld API Key (ë„ˆì˜ í‚¤ë¡œ ë³€ê²½)
        // ---------------------------
        const VWORLD_KEY = "YOUR_VWORLD_KEY";

        let map;

        // ---------------------------
        // ğŸ“Œ Google Map ì´ˆê¸°í™”
        // ---------------------------
        function initMap() {
            const center = { lat: 37.5665, lng: 126.9780 }; // ì„œìš¸ ê¸°ë³¸ ì¤‘ì‹¬

            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
                center: center,
            });

            // ìµœì´ˆ ë¡œë”© ì‹œ ë„ê·¼ì  20ê°œ í‘œì‹œ
            loadGeogung(center);

            // ì§€ë„ ì›€ì§ì„ ëë‚¬ì„ ë•Œ(center ë³€ê²½ ì‹œ ìë™ ì—…ë°ì´íŠ¸)
            google.maps.event.addListener(map, "idle", function () {
                const c = map.getCenter();
                loadGeogung({ lat: c.lat(), lng: c.lng() });
            });
        }

        // ---------------------------
        // ğŸ“Œ ë„ê·¼ì  20ê°œ ë¶ˆëŸ¬ì˜¤ê¸° (VWorld WFS API)
        // ---------------------------
        function loadGeogung(center) {

            const url = `https://api.vworld.kr/req/wfs?key=${VWORLD_KEY}&domain=http://localhost
            &service=WFS&request=GetFeature&Version=2.0.0&typeNames=lp_pa_cbnd@korea
            &count=20&srsName=EPSG:4326
            &bbox=${center.lng - 0.01},${center.lat - 0.01},${center.lng + 0.01},${center.lat + 0.01},EPSG:4326`
                .replace(/\s+/g, ""); // URL ì¤„ë°”ê¿ˆ ì œê±°

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (!data.response || !data.response.result || !data.response.result.featureCollection) return;

                    const features = data.response.result.featureCollection.features;

                    // ì´ì „ ë§ˆì»¤ ì œê±°
                    if (window.markers) {
                        window.markers.forEach(m => m.setMap(null));
                    }
                    window.markers = [];

                    // ìƒˆ ë§ˆì»¤ ì¶”ê°€
                    features.forEach(f => {
                        const coords = f.geometry.coordinates;
                        const lat = coords[1];
                        const lng = coords[0];

                        const marker = new google.maps.Marker({
                            position: { lat, lng },
                            map: map,
                        });

                        window.markers.push(marker);
                    });
                })
                .catch(err => {
                    console.error("VWorld API ì˜¤ë¥˜:", err);
                });
        }

        // ---------------------------
        // ì§€ë„ ë¡œë“œ
        // ---------------------------
        window.onload = initMap;
    </script>

</body>
</html>
